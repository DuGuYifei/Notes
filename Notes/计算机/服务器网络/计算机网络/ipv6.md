# ipv6

## 介绍
IPv6 地址是 IPv6 网络上主机网络接口的个人或组标识符。 该地址作为目标地址放置在 IPv6 数据报的报头中，可以明确确定该数据报的接收者。 IPv6 地址的**长度为 128 位**。
IPv6 地址在 RFC4291 IP 版本 6 寻址架构及其更新中定义。

备注：`ffff = 1111 1111 1111 1111`

## IPv6 地址的类型

IPv6 地址分为三种类型： 
1. 单播——单播地址是网络节点接口的独立地址。它们用于寻址单个网络设备。
2. 多播——多播地址是组地址。 发送到多播地址的数据报被传递给作为多播组成员的一组收件人。 所有 IPv6 多播地址的最高八位都设置为 1（前缀 `FF00::/8`）。
3. Anycast——Anycast地址，一般来说，就是组地址。 任播寻址的目的是将数据报传送到最近的（根据路由算法）具有给定任播地址的主机。 任播地址没有任何特殊的区别特征——它们与单播地址没有区别。

**值得注意的是，IPv6 没有定义从 IPv4（对所有人）已知的广播地址。**

## 记录 IPv6 地址

### 形式
* 128 位 IPv6 地址以十六进制形式编写，地址的每个 16 位部分之间用冒号分隔。

```
2001:0db8:0000:0001:0000:0000:0000:0001
```

* 为了简化符号，可以在每个部分中分别省略不重要的前导零。
```
2001:db8:0:1:0:0:0:1 
```

* 此外，在 0 值紧接出现的地址中，所谓的 `零压缩`，即用双冒号替换零部分的任何字符串。
  * **注意：零压缩只能在一个地址中执行一次。**
```
2001:db8:0:1::1 
```

### 方括号表示法
* 使用 IPv6 地址编写 Internet 资源的 URL 和 URI 需要额外使用方括号。

```
http://[2001:db8:0:1::1]/ 
```

* 方括号表示法还解决了在 URL 中冒号后指定异常端口号的问题。
```
https://[2001:db8:0:1::1]:443/
```

### MS Windows 特殊表示法
* 在 MS Windows 操作系统中，冒号具有特殊含义，可以使用 IPv6 地址的特殊表示法来寻址本地网络资源，其中冒号替换为减号并添加 ipv6-literal.net 域在地址的末尾。 这种写地址的方法只适用于 MS Windows 系统。
```
\\2001-db8-0-1--1.ipv6-literal.net\drukarka
```

## IPv6地址地址池划分
IPv6地址池划分如下：
| 前缀      | 范围           | 描述                                                                      |
| --------- | -------------- | ------------------------------------------------------------------------- |
| ::/128    | 未指定地址范围 | 未指定的地址                                                              |
| ::/0      | 全局范围       | 全局地址的默认路由                                                        |
| ::1/128   | 回环范围       | 回环地址，相当于IPv4的127.0.0.1                                           |
| 2000::/3  | 全局范围       | 全球单播地址范围 (`2`->`0010`->`001`)                                                 |
| FC00::/7  | 本地地址范围   | 不可路由的私有地址，相当于IPv4的10.0.0.0/8, 172.16.0.0/13, 192.168.0.0/16 |
| FE80::/10 | 本地地址范围   | 链路本地地址（本地地址）的自动配置地址                                    |
| FF00::/8  | 指定地址范围   | 多播地址，范围在FF00::/8内的地址都是指定地址范围内的多播地址              |


* 已从已用 IPv6 地址池中退出的地址为：`::/96`、`0200::/7`、`FEC0::/10`、`3FFE::/16`。
* 在单播地址中，有特殊的保留地址池，例如： `2001:db8::/32` – 用于发布的地址。

## IPv6 地址范围

### 为不同地址准备的多播地址
IPv6地址具有定义的范围（英语：scope），指定该地址适用于网络的哪个部分。对于多播地址，定义了以下范围：没有`3,6,7,9`

| 值  | 范围           | 英文范围                 | 描述                                                                                      |
| --- | -------------- | ------------------------ | ----------------------------------------------------------------------------------------- |
| 0x1 | 回环本地范围   | interface-local scope    | 地址在接口范围内，例如环回地址 ::1/128                                                    |
| 0x2 | 链路本地范围   | link-local scope         | 地址在本地网段范围内（到最近的路由器），例如**自动配置地址** `fe80::/10` 见下接口自动配置 |
| 0x4 | 管理员本地范围 | admin-local scope        | 地址在管理员指定的最小范围内                                                              |
| 0x5 | 站点本地范围   | site-local scope         | 地址在管理员指定站点范围内，例如公司分部                                                  |
| 0x8 | 组织本地范围   | organization-local scope | 地址在整个组织范围内，例如整个公司                                                        |
| 0xE | 全局范围       | global scope             | 地址在全局范围内                                                                          |

IPv6 地址的`多播地址范围标识符`（Multicast Address Scope Identifier）

**备注：`ff`是多播地址的前缀，`ff`后面的4位是多播地址的范围标识符**

```
f    f    |标志 临时/永久 | 范围
1111 1111 |    0001/0000 | 见上表
```

#### 有用的多播地址示例：
* FF02::1 - 本地网络中的主机 
* FF02::2 - 本地网络中的路由器 
* FF0X::101 - 时间服务器（X - 此处表示范围）【时间服务器是指在网络上提供时间服务的计算机，主要目的是确保网络上的所有设备都具有同步时钟并使用相同的时间参考】

### 在IPv6中构建单播地址
单播IPv6地址分为两部分：网络地址和主机ID。IPv6的**默认主机ID为64位**。因此，网络地址也由64位组成。**即标准mask是64位 +  interface identifier（标识网络上设备的特定网络接口） 64位。**

由于为了改进路由而引入的路由，分层网络地址通常分为电信运营商前缀和本地网络ID。

示例：学校204实验室的ipv6地址：
`2001:4070:11:204:0212:34FF:FE56:789A`

* `2001:4070::/32` 是这里的电信运营商前缀：TASK 
* `2001:4070:11::/48` 是互联网提供商的前缀，这里是：KTI
* `2001:4070:11:204::/64` 是管理分配的网络前缀，此处为：204实验室
* `0212:34FF:FE56:789A` 是EUI64主机接口标识符

主主机ID为64位EUI64。EUI64由网络接口的48位MAC标识符（EUI48）创建，方法是在中间添加额外的16位0xFFFE，并将结果标识符中第七个最高的位取反即`0212` -> `02` -> `0000 0010`。



## IPv6地址配置方法
* 自动配置地址
* SLAAC 无状态配置地址
* 管理分配的地址
  * 例如通过 DHCPv6。
  
### 接口自动配置

`fe80::/10 - 1111 1110 10xx xxxx xxxx xxxx xxxx xxxx`

例如 EUI64 的链路自动配置地址方式：
```
MAC 00:12:34:56:78:9A
ip  fe80::0212:34ff:fe56:789a 
```
方法：
1. 分成 24 位组织唯一标识符 (OUI) 和 24 位供应商提供的标识符 (VPI)：24-bit organizationally unique identifier (OUI) and a 24-bit vendor-provided identifier (VPI):
   1. OUI: `00:12:34`
   2. VPI: `56:78:9A`
2. 插入 FFFE
   1. `0012:34FF:FE56:789A`
3. 结果第七位反转为1成为为0212表示本地。
   1. `0212:34FF:FE56:789A`

### SLAAC 无状态配置地址
具有广播前缀 `2001:db8:0:1::/64` 和接口 MAC 地址 `00:12:34:56:78:9A` 的网络上无状态自动配置地址的示例是：
```
2001:db8:0:1:0212:34ff:fe56:789a
```

## ICMP
IPv6 不使用 ARP。 ICMPv6 用于所有连接控制任务。 与IPv4相比，新的ICMPv6协议机制是：
1. MLD (Multicast Listener Discovery) - 一种用于执行与多播组支持相关的任务的机制。 在 IPv6 寻址中，广播地址的作用已被多播地址取代，因此它们的使用更加频繁。
2. ND（Neighbor Discovery）—— 邻居发现机制。 该机制旨在处理数据链路层地址，它取代并扩展了 IPv4 中已知的 ARP 协议的功能。
3. SLAAC（Stateless Address Autoconfiguration）—— 一种基于数据链路层地址的自动节点寻址机制。
4. RR（路由器重新编号）—— 一种与网络前缀处理和 IPv6 路由器自动化相关的机制。

邻居发现（Neighbor Discovery，简称ND）机制提供了在本地网络中发现主机、将数据链路层（MAC）地址映射到IPv6地址、查找路由器并由路由器广播正确网络前缀，这些都是无状态地址自动配置（SLAAC）中使用的功能。

