# Inno_Setup打包

案例：

```perl
; Script generated by the Inno Setup Script Wizard.
; SEE THE DOCUMENTATION FOR DETAILS ON CREATING INNO SETUP SCRIPT FILES!

#define MyAppName "AnyWXHelper"
#define MyAppVersion "v3.0.1"
#define MyAppPublisher "AnyHelper, Inc."
#define MyAppURL "https://aitob.ai/"
#define MyAppExeName "tobi_bot"
#define ExeSuffix ".exe"

[Setup]
; NOTE: The value of AppId uniquely identifies this application. Do not use the same AppId value in installers for other applications.
; (To generate a new GUID, click Tools | Generate GUID inside the IDE.)
AppId={{20CB70EC-0A05-45C9-BFFF-1427D824D9FF}
AppName={#MyAppName}
AppVersion={#MyAppVersion}
;AppVerName={#MyAppName} {#MyAppVersion}
AppPublisher={#MyAppPublisher}
AppPublisherURL={#MyAppURL}
AppSupportURL={#MyAppURL}
AppUpdatesURL={#MyAppURL}
DefaultDirName={autopf}\{#MyAppName}
DisableProgramGroupPage=yes
InfoAfterFile=D:\duguyifei\code\WX_AI\go_client\dist\用户须知.txt
; Uncomment the following line to run in non administrative install mode (install for current user only.)
;PrivilegesRequired=lowest
OutputBaseFilename=AnyWXHelper_bot_setup_{#MyAppVersion}
Compression=lzma
SolidCompression=yes
WizardStyle=modern

[Code]
function ReplaceStr(const S, OldPattern, NewPattern: string): string;
var
  SearchStr, Patt, NewStr: string;
  Offset: Integer;
begin
  if OldPattern = '' then
  begin
    Result := S;
    Exit;
  end;
  
  SearchStr := S;
  Patt := OldPattern;
  NewStr := '';
  
  while SearchStr <> '' do
  begin
    Offset := Pos(Patt, SearchStr);
    if Offset = 0 then
    begin
      NewStr := NewStr + SearchStr;
      SearchStr := '';
    end
    else
    begin
      NewStr := NewStr + Copy(SearchStr, 1, Offset - 1) + NewPattern;
      SearchStr := Copy(SearchStr, Offset + Length(OldPattern), MaxInt);
    end;
  end;
  
  Result := NewStr;
end;

var
  PathInputPage: TInputDirWizardPage;
  AccountInputPage: TInputQueryWizardPage;
  KeyInputPage: TInputQueryWizardPage;
  WeChatInstallPath: string;
  WeChatCachePath: string;
  WeChatAccount: string;
  SecrectKey: string;
  HeartBeatUrl: string;

procedure InitializeWizard;
begin
  // 创建路径输入的向导页面
  PathInputPage := CreateInputDirPage(wpWelcome,
    '选择路径', '请选择微信的安装路径和文件缓存路径。安装路径可通过右键微信快捷方式打开所在文件夹，再右键打开所在文件夹即可找到。', //文件缓存路径一般在 文档->WeChat Files',
    '', False, 'New Folder');
  PathInputPage.Add('微信安装路径:');
  // PathInputPage.Add('微信文件缓存路径:');

  // 创建微信账号输入的向导页面
  AccountInputPage := CreateInputQueryPage(PathInputPage.ID,
    '输入 一个 用于运行bot的微信号', '如果想多开，安装后可自行在config.json文件中添加，其他细节配置也可以去config.json中更换，具体见安装后的"用户须知.txt"', '');
  AccountInputPage.Add('运行用的微信号:', False);

  // 创建密钥输入的向导页面
  KeyInputPage := CreateInputQueryPage(AccountInputPage.ID,
    '输入密钥', '密钥', '');
  KeyInputPage.Add('密钥:', False);
end;

function ConvertPathToDoubleSlash(Path: string): string;
begin
  // 将单斜杠转为双斜杠
  Result := ReplaceStr(Path, '\', '\\');
end;

function NextButtonClick(CurPageID: Integer): Boolean;
begin
  Result := True;

  if CurPageID = PathInputPage.ID then
  begin
    WeChatInstallPath := ConvertPathToDoubleSlash(PathInputPage.Values[0]);
    // WeChatCachePath := ConvertPathToDoubleSlash(PathInputPage.Values[1]);
    
    if (WeChatInstallPath = '') then //or (WeChatCachePath = '') then
    begin
      MsgBox('您必须指定微信的安装路径', mbError, MB_OK); //和文件缓存路径。', mbError, MB_OK);
      Result := False;
    end;
  end
  else if CurPageID = AccountInputPage.ID then
  begin
    WeChatAccount := AccountInputPage.Values[0];
    if WeChatAccount = '' then
    begin
      MsgBox('您必须输入运行用的微信号。', mbError, MB_OK);
      Result := False;
    end;
  end
  else if CurPageID = KeyInputPage.ID then
  begin
    SecrectKey := KeyInputPage.Values[0];
    if SecrectKey = '' then
    begin
      MsgBox('您必须输入密钥。', mbError, MB_OK);
      Result := False;
    end;
  end;
end;

procedure CurStepChanged(CurStep: TSetupStep);
var
  OutputData: string;
  FileName: string;
begin
  // 当安装即将完成时
  if CurStep = ssPostInstall then
  begin
    OutputData := '{' + #13#10 +
                  '    "key": "' + SecrectKey + '",' + #13#10 +
                  '    "wx_path": "' + WeChatInstallPath + '",' + #13#10 +
                  '    "wx": [' + #13#10 +
                  '        {' + #13#10 +
                  '            "wx_account": "' + WeChatAccount + '",' + #13#10 +
                  '            "heartbeat_url": "http://anychinavisa.com:9000/ping/870ea120-6bb7-40ee-a430-1405d9c54f49",' + #13#10 +
                  '            "chatbot_id": "783",' + #13#10 +
                  '            "chatbot_hash_id": "bEVOa0lQWGVMZDIvQlFxRWppdVV4QT09",' + #13#10 +
                  '            "chatbot_mass_message_id": "777",' + #13#10 +
                  '            "voice_reply": "I''m sorry, I can''t hear what you''re saying. Could you send it to me in text form?",' + #13#10 +
                  '            "card_reply": "Thank you for sharing the card with me, I will see later.",' + #13#10 +
                  '            "img_video_reply": "If you want to send some images or videos to me, can you send to our email visa@anyhelper.cn and mark your name? Thank you.",' + #13#10 +
                  '            "file_reply": "If you want to send some docs to me, can you send to our email visa@anyhelper.cn and mark your name? Thank you.",' + #13#10 +
                  '            "group_welcome_msg": ", [庆祝][庆祝][庆祝] welcome to join us! [烟花][烟花][烟花]",' + #13#10 +
                  '            "is_ai": true,' + #13#10 +
                  '            "is_only_cmd": false,' + #13#10 +
                  '            "is_store_gzh_knowledge": true,' + #13#10 +
                  '            "is_delete_friend": false,' + #13#10 +
                  '            "admin_wx_account": []' + #13#10 +
                  '        }' + #13#10 +
                  '    ]' + #13#10 +
                  '}';

    
    FileName := ExpandConstant('{app}\config.json');
    SaveStringToFile(FileName, OutputData, False);
  end;
end;


[Languages]
Name: "chinesesimplified"; MessagesFile: "compiler:Languages\ChineseSimplified.isl"

[Tasks]
Name: "desktopicon"; Description: "{cm:CreateDesktopIcon}"; GroupDescription: "{cm:AdditionalIcons}"; Flags: unchecked

[Files]
Source: "D:\duguyifei\code\WX_AI\go_client\dist\anyhelper.ico"; DestDir: "{app}"; Flags: ignoreversion
Source: "D:\duguyifei\code\WX_AI\go_client\dist\{#MyAppExeName}_{#MyAppVersion}{#ExeSuffix}"; DestDir: "{app}"; Flags: ignoreversion
Source: "D:\duguyifei\code\WX_AI\go_client\dist\用户须知.txt"; DestDir: "{app}"; Flags: ignoreversion
Source: "D:\duguyifei\code\WX_AI\go_client\dist\log.xml"; DestDir: "{app}"; Flags: ignoreversion
Source: "D:\duguyifei\code\WX_AI\go_client\dist\plugins\*"; DestDir: "{app}\plugins"; Flags: ignoreversion recursesubdirs createallsubdirs
; NOTE: Don't use "Flags: ignoreversion" on any shared system files

[Icons]
Name: "{autoprograms}\{#MyAppName}_{#MyAppVersion}"; Filename: "{app}\{#MyAppExeName}_{#MyAppVersion}{#ExeSuffix}";IconFilename: "{app}\anyhelper.ico"
Name: "{autodesktop}\{#MyAppName}_{#MyAppVersion}"; Filename: "{app}\{#MyAppExeName}_{#MyAppVersion}{#ExeSuffix}"; Tasks: desktopicon;IconFilename: "{app}\anyhelper.ico"

[Run]
Filename: "{app}\{#MyAppExeName}_{#MyAppVersion}{#ExeSuffix}"; Description: "{cm:LaunchProgram,{#StringChange(MyAppName, '&', '&&')}}"; Flags: nowait postinstall skipifsilent

```