# 线程锁

锁的不是代码，而是对象

线程锁的两个特性:
1. 互斥性：同一时间只能有一个对象持有线程锁，通过这种特性实现多线程的协调机制。同一时间只有一个线程对需要同步的代码块进行访问，也成为原子性
2. 可见性：必须确保在锁释放之前，其对于共享变量的修改对下一个获得该锁的线程是可见的，否则另一个线程可能是在本地缓存的某个副本上进行，从而引起不一致

[synchronized](synchronized.md)

## 对象锁
```java
// 同步代码块
synchronized(this)
synchronized(类实例对象)
// 同步非静态方法
synchronized(method)
```

## 类锁
```java
synchronized(Ticket.class){
}
```

* 线程访问该对象的同步代码块时，其他线程可以访问该线程的非同步代码块
* 若锁住的是对象，则当一个线程访问该对象的同步代码块（非静态方法），其它线程不能访问这个对象的同步代码块（非静态方法）
* 若锁住的是对象，则当一个线程访问该对象的同步代码块（非静态方法），其它线程不能访问这个对象的非静态方法（同步代码块）
* 若锁住的是类，则当一个线程访问该类的同步代码块（**静态方法**），其它线程不能访问这个类的同步代码块（静态方法）
* 若锁住的是类，则当一个线程访问该类的同步代码块（**静态方法**），其它线程不能访问这个类的静态方法（同步代码块）

* **同一个类不同的对象锁互不干扰**
* 类锁和对象锁互不干扰
* 同一个类的不同对象使用类锁是也会同步